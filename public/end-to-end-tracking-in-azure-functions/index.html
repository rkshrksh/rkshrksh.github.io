<!DOCTYPE html>
<html lang="en-US">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="http://localhost:1313/images/favicon.png" />
<title>End-to-End Tracking in Azure Functions | rksh.me</title>
<meta name="title" content="End-to-End Tracking in Azure Functions" />
<meta name="description" content="Learn how to implement end-to-end request tracking using TrackingID in Azure Functions and Service Bus with structured logging and scoped diagnostics." />
<meta name="keywords" content="azure-functions,service-bus,tracking,logging,distributed-systems," />


<meta property="og:url" content="http://localhost:1313/end-to-end-tracking-in-azure-functions/">
  <meta property="og:site_name" content="rksh.me">
  <meta property="og:title" content="End-to-End Tracking in Azure Functions">
  <meta property="og:description" content="Learn how to implement end-to-end request tracking using TrackingID in Azure Functions and Service Bus with structured logging and scoped diagnostics.">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-07-19T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-19T00:00:00+00:00">
    <meta property="article:tag" content="Azure-Functions">
    <meta property="article:tag" content="Service-Bus">
    <meta property="article:tag" content="Tracking">
    <meta property="article:tag" content="Logging">
    <meta property="article:tag" content="Distributed-Systems">
    <meta property="og:image" content="http://localhost:1313/images/share.jpg">




  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/images/share.jpg">
  <meta name="twitter:title" content="End-to-End Tracking in Azure Functions">
  <meta name="twitter:description" content="Learn how to implement end-to-end request tracking using TrackingID in Azure Functions and Service Bus with structured logging and scoped diagnostics.">




  <meta itemprop="name" content="End-to-End Tracking in Azure Functions">
  <meta itemprop="description" content="Learn how to implement end-to-end request tracking using TrackingID in Azure Functions and Service Bus with structured logging and scoped diagnostics.">
  <meta itemprop="datePublished" content="2025-07-19T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-07-19T00:00:00+00:00">
  <meta itemprop="wordCount" content="604">
  <meta itemprop="image" content="http://localhost:1313/images/share.jpg">
  <meta itemprop="keywords" content="Azure-Functions,Service-Bus,Tracking,Logging,Distributed-Systems">
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  :root {
    --width: 720px;
    --font-main: Verdana, sans-serif;
    --font-secondary: Verdana, sans-serif;
    --font-scale: 1em;
    --background-color: #fff;
    --heading-color: #222;
    --text-color: #444;
    --link-color: #3273dc;
    --visited-color: #8b6fcb;
    --code-background-color: #f2f2f2;
    --code-color: #222;
    --blockquote-color: #222;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --background-color: #01242e;
      --heading-color: #eee;
      --text-color: #ddd;
      --link-color: #8cc2dd;
      --visited-color: #8b6fcb;
      --code-background-color: #000;
      --code-color: #ddd;
      --blockquote-color: #ccc;
    }
  }

  body {
    font-family: var(--font-secondary);
    font-size: var(--font-scale);
    margin: auto;
    padding: 20px;
    max-width: var(--width);
    text-align: left;
    background-color: var(--background-color);
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: var(--text-color);
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: var(--font-main);
    color: var(--heading-color);
  }

  a {
    color: var(--link-color);
    cursor: pointer;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  nav a {
    margin-right: 8px;
  }

  strong,
  b {
    color: var(--heading-color);
  }

  button {
    margin: 0;
    cursor: pointer;
  }

  time {
    font-family: monospace;
    font-style: normal;
    font-size: 15px;
  }

  main {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  hr {
    border: 0;
    border-top: 1px dashed;
  }

  img {
    max-width: 100%;
  }

  code {
    font-family: monospace;
    padding: 2px;
    background-color: var(--code-background-color);
    color: var(--code-color);
    border-radius: 3px;
  }

  blockquote {
    border-left: 1px solid #999;
    color: var(--code-color);
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px 0;
    text-align: center;
  }

  .title:hover {
    text-decoration: none;
  }

  .title h1 {
    font-size: 1.5em;
  }

  .inline {
    width: auto !important;
  }

  .highlight,
  .code {
    padding: 1px 15px;
    background-color: var(--code-background-color);
    color: var(--code-color);
    border-radius: 3px;
    margin-block-start: 1em;
    margin-block-end: 1em;
    overflow-x: auto;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: var(--visited-color);
  }

</style>

</head>

<body>
  <header><a href="/" class="title">
  <h2>rksh.me</h2>
</a>
<nav>
<a href="/">Home</a>

<a href="/blog/">Blog</a>

</nav>
</header>
  <main>

<h1>End-to-End Tracking in Azure Functions</h1>
<p>
  <i>
    <time datetime='2025-07-19'>
      19 Jul, 2025
    </time>
  </i>
</p>

<content>
  <p>In today&rsquo;s cloud-native applications, services are increasingly distributed—events trigger processes, APIs invoke background jobs, and messages flow asynchronously via queues or topics.</p>
<p>While this decoupling improves scalability, it makes <strong>observability</strong> more challenging. When something goes wrong, how do you trace the full journey of a single user&rsquo;s request across dozens of services?</p>
<p>The answer: <strong>End-to-End Tracking</strong> using a correlation ID or <code>TrackingID</code>. In this blog, you’ll learn how to implement request tracking in <strong>Azure Functions</strong> that communicate through <strong>Azure Service Bus</strong> using the modern SDK.</p>
<h2 id="architecture-at-a-glance">Architecture at a Glance</h2>
<ol>
<li><strong>Producer Function</strong>: Receives an HTTP request, generates or extracts a <code>TrackingID</code>, sends a message to Service Bus with this ID as a custom property.</li>
<li><strong>Consumer Function</strong>: Listens to the Service Bus queue or topic, reads the <code>TrackingID</code>, and uses <code>BeginScope</code> for structured logging. It can optionally pass the ID further as needed.</li>
</ol>
<h2 id="1-producer-function--sending-a-message-with-trackingid">1. Producer Function – Sending a Message with <code>TrackingID</code></h2>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-17">17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-18">18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-19">19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-20">20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-21">21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-22">22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-23">23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-24">24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-25">25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-26">26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-27">27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-28"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-28">28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-29"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-29">29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-0-30"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-30">30</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#ff7b72">public</span> <span style="color:#ff7b72">static</span> <span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">ProducerFunction</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    [FunctionName(&#34;ProducerFunction&#34;)]
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">public</span> <span style="color:#ff7b72">static</span> <span style="color:#ff7b72">async</span> Task&lt;IActionResult&gt; Run(
</span></span><span style="display:flex;"><span>        [HttpTrigger(AuthorizationLevel.Function, &#34;post&#34;, Route = null)] HttpRequest req,
</span></span><span style="display:flex;"><span>        [ServiceBus(&#34;myqueue&#34;, Connection = &#34;ServiceBusConnection&#34;)] IAsyncCollector&lt;ServiceBusMessage&gt; outputMessages,
</span></span><span style="display:flex;"><span>        ILogger log)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">string</span> requestBody = <span style="color:#ff7b72">await</span> <span style="color:#ff7b72">new</span> StreamReader(req.Body).ReadToEndAsync();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b949e;font-style:italic">// Extract or generate a TrackingID</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">string</span> trackingId = req.Headers.ContainsKey(<span style="color:#a5d6ff">&#34;TrackingID&#34;</span>)
</span></span><span style="display:flex;"><span>            ? req.Headers[<span style="color:#a5d6ff">&#34;TrackingID&#34;</span>].ToString()
</span></span><span style="display:flex;"><span>            : Guid.NewGuid().ToString();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b949e;font-style:italic">// Create and send the Service Bus message with custom property</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">var</span> message = <span style="color:#ff7b72">new</span> ServiceBusMessage(Encoding.UTF8.GetBytes(requestBody));
</span></span><span style="display:flex;"><span>        message.ApplicationProperties[<span style="color:#a5d6ff">&#34;TrackingID&#34;</span>] = trackingId;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        log.LogInformation(<span style="color:#a5d6ff">&#34;Sending message with TrackingID: {TrackingID}&#34;</span>, trackingId);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">await</span> outputMessages.AddAsync(message);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">new</span> OkObjectResult(<span style="color:#ff7b72">new</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Status = <span style="color:#a5d6ff">&#34;Message sent&#34;</span>,
</span></span><span style="display:flex;"><span>            TrackingID = trackingId
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Highlights:</strong></p>
<ul>
<li>Uses the <code>Azure.Messaging.ServiceBus</code> SDK.</li>
<li>Attaches <code>TrackingID</code> as a custom application property.</li>
<li>Logs the <code>TrackingID</code> for traceability.</li>
</ul>
<h2 id="2-consumer-function--receiving-and-logging-with-trackingid">2. Consumer Function – Receiving and Logging with <code>TrackingID</code></h2>
<p>This consumer reads from the queue/topic, extracts the <code>TrackingID</code>, and uses <code>BeginScope</code> to enrich logs across the entire scope.</p>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-17">17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-18">18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-19">19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-20">20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-21">21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-22">22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-23">23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-24">24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-25">25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-26">26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-27">27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679" id="hl-1-28"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-28">28</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#ff7b72">public</span> <span style="color:#ff7b72">static</span> <span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">ConsumerFunction</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    [FunctionName(&#34;ConsumerFunction&#34;)]
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">public</span> <span style="color:#ff7b72">static</span> <span style="color:#ff7b72">async</span> Task Run(
</span></span><span style="display:flex;"><span>        [ServiceBusTrigger(&#34;myqueue&#34;, Connection = &#34;ServiceBusConnection&#34;)] ServiceBusReceivedMessage message,
</span></span><span style="display:flex;"><span>        ILogger log)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#8b949e;font-style:italic">// Extract TrackingID from the message properties</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">string</span> trackingId = message.ApplicationProperties.ContainsKey(<span style="color:#a5d6ff">&#34;TrackingID&#34;</span>)
</span></span><span style="display:flex;"><span>            ? message.ApplicationProperties[<span style="color:#a5d6ff">&#34;TrackingID&#34;</span>].ToString()
</span></span><span style="display:flex;"><span>            : <span style="color:#a5d6ff">&#34;N/A&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b949e;font-style:italic">// Begin a logging scope that includes the TrackingID</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">using</span> (log.BeginScope(<span style="color:#ff7b72">new</span> Dictionary&lt;<span style="color:#ff7b72">string</span>, <span style="color:#ff7b72">object</span>&gt; { [<span style="color:#a5d6ff">&#34;TrackingID&#34;</span>] = trackingId }))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            log.LogInformation(<span style="color:#a5d6ff">&#34;Received message with TrackingID: {TrackingID}&#34;</span>, trackingId);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b949e;font-style:italic">// Simulate message processing</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff7b72">string</span> body = Encoding.UTF8.GetString(message.Body);
</span></span><span style="display:flex;"><span>            log.LogInformation(<span style="color:#a5d6ff">&#34;Processing message body: {Body}&#34;</span>, body);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b949e;font-style:italic">// Pass trackingId downstream if needed</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b949e;font-style:italic">// For example, add it to outgoing HTTP headers or service calls</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">await</span> Task.CompletedTask;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Scope Logging Bonus:</strong><br>
By using <code>log.BeginScope</code>, every log inside that scope gets auto-tagged with <code>TrackingID</code>. This is powerful with log aggregators like Application Insights, Elastic Stack, or Datadog.</p>
<h2 id="propagating-trackingid-to-downstream-services">Propagating <code>TrackingID</code> to Downstream Services</h2>
<p>Once you&rsquo;ve got the <code>TrackingID</code>, you can:</p>
<ul>
<li>Send it as a header in HTTP requests:
<pre tabindex="0"><code>httpClient.DefaultRequestHeaders.Add(&#34;TrackingID&#34;, trackingId);
</code></pre></li>
<li>Use it in telemetry or performance metrics</li>
<li>Store it in databases or audit trails</li>
</ul>
<p>Keeping track of the ID across services provides <strong>unified visibility</strong>, even on large-scale systems.</p>
<h2 id="conclusion">Conclusion</h2>
<p>With just a few lines of code, you can significantly improve observability in your distributed Azure solution:</p>
<ul>
<li>Use <code>TrackingID</code> as a unique correlation ID</li>
<li>Forward it through Service Bus with <code>ApplicationProperties</code></li>
<li>Use <code>BeginScope</code> to enrich logs at every stage</li>
</ul>
<p>This lightweight pattern is easy to add, doesn’t impact performance, and unlocks powerful traceability across your event-driven architecture.</p>
<h2 id="whats-next">What’s Next?</h2>
<ul>
<li>Integrate Application Insights for centralized tracking</li>
<li>Extend this pattern to handle retries and dead-letter messages</li>
<li>Use Middleware or DelegatingHandlers to forward <code>TrackingID</code> in outgoing HTTP requests automatically</li>
</ul>
<p>Happy tracing!</p>

</content>
<p>
  
  <a href="http://localhost:1313/blog/azure-functions/">#Azure-Functions</a>
  
  <a href="http://localhost:1313/blog/service-bus/">#Service-Bus</a>
  
  <a href="http://localhost:1313/blog/tracking/">#Tracking</a>
  
  <a href="http://localhost:1313/blog/logging/">#Logging</a>
  
  <a href="http://localhost:1313/blog/distributed-systems/">#Distributed-Systems</a>
  
</p>

  </main>
  <footer>
</footer>

  
</body>

</html>
